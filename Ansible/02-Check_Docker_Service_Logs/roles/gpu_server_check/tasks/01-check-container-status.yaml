---
- name: ğŸ•’ Set custom timestamp for filename
  ansible.builtin.set_fact:
    now: "{{ lookup('pipe', 'date +%F-%H-%M-%S') }}"

- name: ğŸ³ Get running container status
  ansible.builtin.shell: >
    docker ps --format "table {{ '{{' }}.Names{{ '}}' }}\t{{ '{{' }}.Status{{ '}}' }}"
  register: docker_status
  changed_when: false

- name: ğŸ“ Ensure ./reports directory exists on control node
  delegate_to: localhost
  become: false
  ansible.builtin.file:
    path: "./reports"
    state: directory
    mode: '0755'

- name: ğŸ’¾ Save container status to local file
  delegate_to: localhost
  become: false
  copy:
    dest: "./reports/{{ inventory_hostname }}-status.txt"
    content: |
      ğŸ–¥ï¸ Node: {{ inventory_hostname }}
      ğŸ“… Date: {{ now }}

      ğŸ“¦ Container Status:
      {% for line in docker_status.stdout_lines %}
      {{ line }}
      {% endfor %}